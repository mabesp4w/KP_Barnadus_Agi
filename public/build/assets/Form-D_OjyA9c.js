import{r as c,j as e,u as I,H as z,L as R,z as S}from"./app-Dooz9cHf.js";import{L as f}from"./leaflet-DivYvL9y.js";import{B as E}from"./Button-7TB1XEkM.js";import{C,b as L,c as F,a as $}from"./Card-B0G3RUpM.js";import{u as B}from"./useAOS-DdGHiMai.js";import{A as K}from"./AdminLayout-BKbcV1we.js";import{A as q}from"./arrow-left-Bxvp9jnO.js";import{M as D}from"./map-pin-DrVUcQE4.js";import"./createLucideIcon-BmYDW1BA.js";import"./users-Liyq1aVu.js";import"./x-DZbbTUlO.js";import"./graduation-cap-B4lrwTNV.js";delete f.Icon.Default.prototype._getIconUrl;f.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const M={osm:{name:"OpenStreetMap (Label Lengkap)",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',subdomains:"abc"},positron:{name:"Positron (Light)",url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd"},voyager:{name:"Voyager (Colorful)",url:"https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd"},dark:{name:"Dark Matter",url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd"}};function U({latitude:r,longitude:u,onLocationChange:h,height:m="400px",sekolahs:x=[]}){const n=c.useRef(null),s=c.useRef(null),b=c.useRef(null),g=c.useRef([]),_=c.useRef(null),[a,T]=c.useState(!1),[N,t]=c.useState("osm"),k=-2.5333,v=140.7167,p=r&&parseFloat(r)?parseFloat(r):k,y=u&&parseFloat(u)?parseFloat(u):v;c.useEffect(()=>{if(!n.current||s.current)return;const l=f.map(n.current,{zoomControl:!0}).setView([p,y],13),i=M[N]||M.osm,o={attribution:i.attribution,maxZoom:19};i.subdomains&&(o.subdomains=i.subdomains),i.tms&&(o.tms=!0);const P=f.tileLayer(i.url,o).addTo(l);_.current=P;const d=f.marker([p,y],{draggable:!0,autoPan:!0}).addTo(l);return d.bindPopup(`Koordinat: ${p.toFixed(6)}, ${y.toFixed(6)}`).openPopup(),d.on("dragend",function(w){const j=d.getLatLng();d.setPopupContent(`Koordinat: ${j.lat.toFixed(6)}, ${j.lng.toFixed(6)}`).openPopup(),h&&h(j.lat,j.lng)}),l.on("click",function(w){const{lat:j,lng:A}=w.latlng;d.setLatLng([j,A]),d.setPopupContent(`Koordinat: ${j.toFixed(6)}, ${A.toFixed(6)}`).openPopup(),h&&h(j,A)}),s.current=l,b.current=d,T(!0),()=>{s.current&&g.current.forEach(w=>{w&&s.current.removeLayer(w)}),g.current=[],s.current&&(s.current.remove(),s.current=null,b.current=null)}},[]),c.useEffect(()=>{!a||!s.current||!x||x.length===0||(g.current.forEach(l=>{l&&s.current.removeLayer(l)}),g.current=[],x.forEach(l=>{const i=parseFloat(l.latitude),o=parseFloat(l.longitude);if(isNaN(i)||isNaN(o))return;const P=f.divIcon({className:"custom-marker-sekolah",html:`<div style="
                    background-color: #3b82f6;
                    width: 20px;
                    height: 20px;
                    border-radius: 50%;
                    border: 3px solid white;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.4);
                    position: relative;
                "></div>`,iconSize:[20,20],iconAnchor:[10,10],popupAnchor:[0,-10]}),d=f.marker([i,o],{icon:P,zIndexOffset:-100}).addTo(s.current),w=`
                <div style="min-width: 150px;">
                    <strong>${l.nm_sekolah||"Sekolah"}</strong>
                    ${l.alamat?`<br><small>${l.alamat}</small>`:""}
                </div>
            `;d.bindPopup(w),g.current.push(d)}))},[x,a]),c.useEffect(()=>{if(a&&b.current&&s.current){const l=r&&parseFloat(r)?parseFloat(r):null,i=u&&parseFloat(u)?parseFloat(u):null;if(l!==null&&i!==null){const o=b.current.getLatLng();(Math.abs(o.lat-l)>1e-4||Math.abs(o.lng-i)>1e-4)&&(b.current.setLatLng([l,i]),b.current.setPopupContent(`Koordinat: ${l.toFixed(6)}, ${i.toFixed(6)}`),s.current.setView([l,i],s.current.getZoom()))}}},[r,u,a]),c.useEffect(()=>{if(!a||!s.current||!_.current)return;const l=M[N]||M.osm;s.current.removeLayer(_.current);const i={attribution:l.attribution,maxZoom:19};l.subdomains&&(i.subdomains=l.subdomains),l.tms&&(i.tms=!0);const o=f.tileLayer(l.url,i).addTo(s.current);_.current=o},[N,a]);const O=l=>{t(l.target.value)};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
                .custom-marker-sekolah {
                    background: transparent !important;
                    border: none !important;
                }
            `}),e.jsxs("div",{className:"relative w-full overflow-hidden rounded-lg border border-base-300",style:{height:m},children:[e.jsx("div",{className:"absolute top-2 right-2 z-[1000]",children:e.jsx("select",{value:N,onChange:O,className:"select-bordered select select-sm bg-base-100 shadow-lg",style:{minWidth:"180px"},children:Object.entries(M).map(([l,i])=>e.jsx("option",{value:l,children:i.name},l))})}),e.jsx("div",{ref:n,className:"z-0 h-full w-full",style:{height:m}})]})]})}function se({sekolah:r=null,kelurahans:u=[],sekolahs:h=[]}){B();const m=!!r,x=r?.id,{data:n,setData:s,post:b,put:g,processing:_,errors:a}=I({npsn:r?.npsn||"",nm_sekolah:r?.nm_sekolah||"",id_kelurahan:r?.id_kelurahan||"",alamat:r?.alamat||"",no_telp:r?.no_telp||"",email:r?.email||"",website:r?.website||"",latitude:r?.latitude||"",longitude:r?.longitude||"",thn_berdiri:r?.thn_berdiri||"",status_sekolah:r?.status_sekolah||"aktif",akreditasi:r?.akreditasi||"Belum",tgl_akreditasi:r?.tgl_akreditasi||"",ket:r?.ket||"",foto_utama:r?.foto_utama||""}),T=t=>{if(t.preventDefault(),m){const k=typeof route=="function"&&route("admin.sekolah.update",x)&&route("admin.sekolah.update",x)!=="#"||`/admin/sekolah/${x}`,v=S.loading("Memperbarui sekolah...",{duration:1/0});g(k,{preserveScroll:!1,onSuccess:()=>{S.dismiss(v)},onError:p=>{const y=p&&Object.keys(p).length>0?"Gagal memperbarui sekolah. Periksa form Anda.":"Gagal memperbarui sekolah";S.error(y,{id:v,duration:5e3})}})}else{const k=typeof route=="function"&&route("admin.sekolah.store")&&route("admin.sekolah.store")!=="#"||"/admin/sekolah",v=S.loading("Menyimpan sekolah...",{duration:1/0});b(k,{preserveScroll:!1,onSuccess:()=>{S.dismiss(v)},onError:p=>{const y=p&&Object.keys(p).length>0?"Gagal menambahkan sekolah. Periksa form Anda.":"Gagal menambahkan sekolah";S.error(y,{id:v,duration:5e3})}})}},N=typeof route=="function"&&route("admin.sekolah.index")&&route("admin.sekolah.index")!=="#"||"/admin/sekolah";return e.jsxs(K,{title:m?"Edit Sekolah":"Tambah Sekolah",children:[e.jsx(z,{title:m?"Edit Sekolah":"Tambah Sekolah"}),e.jsxs("div",{className:"mx-auto max-w-4xl",children:[e.jsxs("div",{className:"mb-6","data-aos":"fade-down",children:[e.jsxs(R,{href:N,className:"mb-4 inline-flex items-center text-sm text-base-content/70 hover:text-base-content",children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Kembali ke Daftar Sekolah"]}),e.jsx("h2",{className:"text-2xl font-bold",children:m?"Edit Sekolah":"Tambah Sekolah Baru"}),e.jsx("p",{className:"text-sm text-base-content/70",children:m?"Perbarui data sekolah":"Masukkan data sekolah yang akan ditambahkan"})]}),e.jsxs("form",{onSubmit:T,children:[e.jsxs(C,{className:"mb-6","data-aos":"fade-up","data-aos-delay":"100",children:[e.jsx(L,{children:e.jsx(F,{children:"Informasi Dasar"})}),e.jsx($,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["NPSN ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("input",{type:"text",placeholder:"Masukkan NPSN",className:`input-bordered input w-full ${a.npsn?"input-error":""}`,value:n.npsn,onChange:t=>s("npsn",t.target.value),required:!0}),a.npsn&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.npsn})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Nama Sekolah ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("input",{type:"text",placeholder:"Masukkan nama sekolah",className:`input-bordered input w-full ${a.nm_sekolah?"input-error":""}`,value:n.nm_sekolah,onChange:t=>s("nm_sekolah",t.target.value),required:!0}),a.nm_sekolah&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.nm_sekolah})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Kelurahan ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsxs("select",{className:`select-bordered select w-full ${a.id_kelurahan?"select-error":""}`,value:n.id_kelurahan,onChange:t=>s("id_kelurahan",t.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Pilih Kelurahan"}),u.map(t=>e.jsxs("option",{value:t.id,children:[t.nm_kelurahan," - ",t.kecamatan?.nm_kecamatan]},t.id))]}),a.id_kelurahan&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.id_kelurahan})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Alamat ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("textarea",{rows:3,placeholder:"Masukkan alamat lengkap",className:`textarea-bordered textarea w-full ${a.alamat?"textarea-error":""}`,value:n.alamat,onChange:t=>s("alamat",t.target.value),required:!0}),a.alamat&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.alamat})})]})]})})]}),e.jsxs(C,{className:"mb-6","data-aos":"fade-up","data-aos-delay":"200",children:[e.jsx(L,{children:e.jsx(F,{children:"Kontak"})}),e.jsx($,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"No. Telepon"})}),e.jsx("input",{type:"text",placeholder:"Masukkan nomor telepon",className:`input-bordered input w-full ${a.no_telp?"input-error":""}`,value:n.no_telp,onChange:t=>s("no_telp",t.target.value)}),a.no_telp&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.no_telp})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Email"})}),e.jsx("input",{type:"email",placeholder:"Masukkan email",className:`input-bordered input w-full ${a.email?"input-error":""}`,value:n.email,onChange:t=>s("email",t.target.value)}),a.email&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.email})})]}),e.jsxs("div",{className:"form-control sm:col-span-2",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Website"})}),e.jsx("input",{type:"url",placeholder:"https://example.com",className:`input-bordered input w-full ${a.website?"input-error":""}`,value:n.website,onChange:t=>s("website",t.target.value)}),a.website&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.website})})]})]})})]}),e.jsxs(C,{className:"mb-6","data-aos":"fade-up","data-aos-delay":"300",children:[e.jsx(L,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Koordinat Geografis"]})}),e.jsxs($,{children:[e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"mb-2 text-sm text-base-content/70",children:"Pilih lokasi sekolah di peta dengan menggeser marker atau klik pada peta. Koordinat akan otomatis terisi."})}),e.jsx("div",{className:"mb-4",children:e.jsx(U,{latitude:n.latitude,longitude:n.longitude,onLocationChange:(t,k)=>{s("latitude",t.toString()),s("longitude",k.toString())},height:"400px",sekolahs:h})}),h&&h.length>0&&e.jsxs("p",{className:"mb-2 text-xs text-base-content/60",children:[e.jsx("span",{className:"mr-1 inline-block h-3 w-3 rounded-full bg-blue-500"}),"Marker biru menunjukkan lokasi sekolah lain yang sudah terdaftar"]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Latitude ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("input",{type:"number",step:"any",placeholder:"-2.5333",className:`input-bordered input w-full ${a.latitude?"input-error":""}`,value:n.latitude,onChange:t=>{s("latitude",t.target.value),t.target.value&&parseFloat(t.target.value)&&n.longitude&&parseFloat(n.longitude)},required:!0}),a.latitude&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.latitude})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Longitude ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsx("input",{type:"number",step:"any",placeholder:"140.7167",className:`input-bordered input w-full ${a.longitude?"input-error":""}`,value:n.longitude,onChange:t=>{s("longitude",t.target.value),t.target.value&&parseFloat(t.target.value)&&n.latitude&&parseFloat(n.latitude)},required:!0}),a.longitude&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.longitude})})]})]})]})]}),e.jsxs(C,{className:"mb-6","data-aos":"fade-up","data-aos-delay":"400",children:[e.jsx(L,{children:e.jsx(F,{children:"Informasi Sekolah"})}),e.jsxs($,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Tahun Berdiri"})}),e.jsx("input",{type:"number",placeholder:"2000",min:"1900",max:new Date().getFullYear(),className:`input-bordered input w-full ${a.thn_berdiri?"input-error":""}`,value:n.thn_berdiri,onChange:t=>s("thn_berdiri",t.target.value)}),a.thn_berdiri&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.thn_berdiri})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Status Sekolah ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsxs("select",{className:`select-bordered select w-full ${a.status_sekolah?"select-error":""}`,value:n.status_sekolah,onChange:t=>s("status_sekolah",t.target.value),required:!0,children:[e.jsx("option",{value:"aktif",children:"Aktif"}),e.jsx("option",{value:"tidak_aktif",children:"Tidak Aktif"})]}),a.status_sekolah&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.status_sekolah})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsxs("span",{className:"label-text",children:["Akreditasi ",e.jsx("span",{className:"text-error",children:"*"})]})}),e.jsxs("select",{className:`select-bordered select w-full ${a.akreditasi?"select-error":""}`,value:n.akreditasi,onChange:t=>s("akreditasi",t.target.value),required:!0,children:[e.jsx("option",{value:"Belum",children:"Belum"}),e.jsx("option",{value:"A",children:"A"}),e.jsx("option",{value:"B",children:"B"}),e.jsx("option",{value:"C",children:"C"})]}),a.akreditasi&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.akreditasi})})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Tanggal Akreditasi"})}),e.jsx("input",{type:"date",className:`input-bordered input w-full ${a.tgl_akreditasi?"input-error":""}`,value:n.tgl_akreditasi,onChange:t=>s("tgl_akreditasi",t.target.value)}),a.tgl_akreditasi&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.tgl_akreditasi})})]})]}),e.jsxs("div",{className:"form-control mt-4",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text",children:"Keterangan"})}),e.jsx("textarea",{rows:4,placeholder:"Masukkan keterangan tambahan (opsional)",className:`textarea-bordered textarea w-full ${a.ket?"textarea-error":""}`,value:n.ket,onChange:t=>s("ket",t.target.value)}),a.ket&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:a.ket})})]})]})]}),e.jsxs("div",{className:"bg-base flex justify-end gap-2","data-aos":"fade-up","data-aos-delay":"100",children:[e.jsx(R,{href:N,children:e.jsx(E,{type:"button",variant:"outline",children:"Batal"})}),e.jsx(E,{type:"submit",variant:"primary",loading:_,children:m?"Perbarui":"Simpan"})]})]})]})]})}export{se as default};
